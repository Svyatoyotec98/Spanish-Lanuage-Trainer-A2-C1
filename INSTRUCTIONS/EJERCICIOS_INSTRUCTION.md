# Инструкция по заполнению Ejercicios для юнитов 2-10

## Общая информация

Код приложения универсален — один и тот же код обрабатывает все юниты. Для добавления нового ejercicio достаточно заполнить JSON-файл по шаблону Unidad 1.

**Источники данных:**
- ~10% из PDF: название грамматической темы, варианты ответов (hint)
- ~90% генерируется: rule (полное объяснение), questions (60 шт), microTests (10-20 шт)

**PDF источник:** папка `SpanishExcercises/` — раздел "Más ejercicios" из учебника Aula Internacional

---

## Структура JSON файла

```json
{
  "ejercicios": [
    {
      "id": "ejercicio_1",
      "title": "Preposiciones: con, en, entre",
      "hint": "con / en / entre",
      "rule": { /* объяснение правила */ },
      "questions": [ /* 60 вопросов для теста */ ],
      "microTests": [ /* 10-20 вопросов с подсказками */ ]
    }
  ]
}
```

**Правила:**
- 8-12 ejercicios на юнит
- id в формате `ejercicio_N` (ejercicio_1, ejercicio_2, ...)
- Порядок в JSON = порядок в меню

---

## Детальные правила по каждому полю

### 1. `id` — уникальный идентификатор

**Формат:** `ejercicio_N`

```json
"id": "ejercicio_1"
"id": "ejercicio_2"
```

**Важно:** id используется для хранения прогресса. Система автоматически создаёт запись прогресса для каждого нового id.

---

### 2. `title` — название темы

**Источник:** из PDF (раздел "Más ejercicios")

**Формат:** Краткое название грамматической темы на испанском

```json
"title": "Preposiciones: con, en, entre"
"title": "porque vs para"
"title": "Presente de indicativo: verbos irregulares"
```

---

### 3. `hint` — варианты ответов

**Источник:** из PDF (опции в упражнении)

**Формат:** варианты через ` / ` (пробел-слэш-пробел)

```json
"hint": "con / en / entre"
"hint": "porque / para"
"hint": "soy / estoy"
```

**Важно:** hint отображается пользователю как подсказка с доступными вариантами ответа.

---

### 4. `rule` — объяснение грамматического правила

**Источник:** генерируется на основе темы

**Структура:**
```json
"rule": {
  "title": "Название правила на русском",
  "explanation": "Общее объяснение 2-4 предложения",
  "sections": [
    {
      "subtitle": "Подраздел 1",
      "points": ["пункт 1", "пункт 2", "пункт 3"]
    }
  ],
  "examples": [
    {"es": "Испанское предложение.", "ru": "Русский перевод."}
  ]
}
```

#### 4.1 `rule.title`
Название правила на русском с выделением ключевых слов заглавными:

```json
"title": "Предлоги CON, EN, ENTRE"
"title": "PORQUE vs PARA: причина и цель"
```

#### 4.2 `rule.explanation`
Общее объяснение правила (2-4 предложения). Описывает суть различия или применения:

```json
"explanation": "Эти три предлога часто путают, но у каждого своя чёткая функция. CON указывает на сопровождение или инструмент. EN обозначает место или время. ENTRE используется для обозначения положения между объектами."
```

#### 4.3 `rule.sections`
Массив подразделов. Каждый раздел раскрывает один аспект правила.

**Структура section:**
```json
{
  "subtitle": "CON — сопровождение, инструмент",
  "points": [
    "С кем делаешь действие: Vivo <b>con</b> mi familia — Живу с семьёй",
    "Чем/каким инструментом: Escribo <b>con</b> bolígrafo — Пишу ручкой",
    "Характеристика: Un café <b>con</b> leche — Кофе с молоком"
  ]
}
```

**Три паттерна форматирования points:**

| Паттерн | Формат | Пример |
|---------|--------|--------|
| A | Выбор слова | `Функция: Ejemplo <b>слово</b> texto — Перевод` |
| B | Спряжение | `Форма (<i>инфинитив</i>): <b>форма</b> — перевод` |
| C | Конструкция | `<b>Конструкция</b> — перевод` |

**HTML-теги в points:**
- `<b>слово</b>` — выделение ключевого слова (жирный)
- `<i>текст</i>` — дополнительная информация (курсив)

#### 4.4 `rule.examples`
Массив из 3-5 примеров с переводом:

```json
"examples": [
  {"es": "Trabajo con mi hermano en una oficina.", "ru": "Я работаю с братом в офисе."},
  {"es": "Vivo en Madrid con mi familia.", "ru": "Я живу в Мадриде с семьёй."}
]
```

---

### 5. `questions` — банк вопросов для теста

**Источник:** генерируется

**Количество:** ровно 60 вопросов

**Использование:** Система случайно выбирает 15 вопросов для режима "Пройти тест"

**Структура:**
```json
"questions": [
  {"sentence": "Estudio español ___ una academia de idiomas.", "answer": "en"},
  {"sentence": "Me gusta practicar ___ mis compañeros.", "answer": "con"}
]
```

#### 5.1 Правила для `sentence`

**Обязательно:**
- Содержит ровно один пропуск `___`
- Контекст однозначно указывает на правильный ответ
- Естественное испанское предложение

**Паттерны предложений:**

| Тип упражнения | Паттерн | Пример |
|----------------|---------|--------|
| Выбор слова | Слово в контексте | `Vivo ___ Madrid.` → `en` |
| Спряжение | Глагол с субъектом | `Yo ___ español.` (hablar) → `hablo` |
| Конструкция | Начало предложения | `___ tú y yo no hay secretos.` → `Entre` |

#### 5.2 Правила для `answer`

- Точное слово/форма для вставки в пропуск
- Регистр важен: `"En"` если в начале предложения, `"en"` в середине
- Один правильный ответ (без вариантов)

#### 5.3 Распределение по вариантам ответа

Для hint с 3 вариантами (`con / en / entre`) — примерно по 20 вопросов на каждый:

```
con: 20 вопросов
en: 20 вопросов
entre: 20 вопросов
Итого: 60 вопросов
```

---

### 6. `microTests` — вопросы для "Проверь себя"

**Источник:** генерируется

**Количество:** 10-20 вопросов (3-5 на каждый вариант ответа)

**Использование:** Режим "Проверь себя" с подсказками. Отображается 3-4 слота (MAX_MICRO_TEST_SLOTS = 4)

**Структура:**
```json
"microTests": [
  {
    "sentence": "Preparo la cena ___ mi madre.",
    "answer": "con",
    "hint": "С кем ты готовишь ужин?"
  }
]
```

#### 6.1 Отличия от questions

| Параметр | questions | microTests |
|----------|-----------|------------|
| Количество | 60 | 10-20 |
| Подсказка (hint) | Нет | Да |
| Режим | "Пройти тест" | "Проверь себя" |
| Сложность | Разная | Простые, с наводящей подсказкой |

#### 6.2 Правила для `hint` в microTests

Подсказка должна наводить на правильный ответ, не называя его прямо:

```json
"hint": "С кем ты готовишь ужин?"        // → con (сопровождение)
"hint": "Где находятся документы?"       // → en (место)
"hint": "Чем режешь? (инструмент)"       // → con (инструмент)
"hint": "Когда цветут деревья? (время)"  // → En (время)
"hint": "Где расположен сад?"            // → entre (между)
```

#### 6.3 Распределение по вариантам ответа

Для hint с 3 вариантами — по 3-5 вопросов на каждый:

```
con: 5 вопросов с подсказками
en: 5 вопросов с подсказками
entre: 5 вопросов с подсказками
Итого: 15 microTests
```

**Важно:** Система группирует microTests по answer и показывает по 3-4 на экране одновременно.

---

## Пошаговый алгоритм заполнения юнита

### Шаг 1: Анализ PDF
1. Открыть PDF из `SpanishExcercises/`
2. Найти раздел "Más ejercicios" для нужного юнита
3. Выписать все грамматические темы с вариантами ответов

### Шаг 2: Создание ejercicio
Для каждой темы:

```
1. id ← "ejercicio_N" (порядковый номер)
2. title ← название темы из PDF
3. hint ← варианты ответов из PDF через " / "
4. rule ← сгенерировать объяснение правила
5. questions ← сгенерировать 60 вопросов
6. microTests ← сгенерировать 10-20 вопросов с подсказками
```

### Шаг 3: Генерация rule
1. Написать title на русском
2. Написать explanation (2-4 предложения)
3. Создать sections по каждому варианту ответа
4. Добавить 3-5 examples

### Шаг 4: Генерация questions
1. Распределить 60 вопросов по вариантам ответа
2. Каждый вопрос: sentence + answer
3. Контекст должен однозначно указывать на ответ
4. Учитывать регистр answer

### Шаг 5: Генерация microTests
1. Создать 3-5 простых вопросов на каждый вариант ответа
2. Каждый вопрос: sentence + answer + hint
3. Hint должен наводить на ответ

### Шаг 6: Валидация
- [ ] Все поля заполнены
- [ ] questions содержит ровно 60 элементов
- [ ] microTests содержит 10-20 элементов
- [ ] Пропуск `___` есть в каждом sentence
- [ ] JSON валиден

---

## Чек-лист качества

### Для каждого ejercicio:
- [ ] id уникален в пределах юнита
- [ ] title соответствует теме из PDF
- [ ] hint содержит все варианты ответов
- [ ] rule полностью объясняет правило
- [ ] questions: 60 вопросов с равным распределением
- [ ] microTests: 10-20 вопросов с подсказками
- [ ] Все sentence содержат `___`
- [ ] Все answer соответствуют hint

### Для юнита:
- [ ] 8-12 ejercicios
- [ ] id идут по порядку (ejercicio_1, ejercicio_2, ...)
- [ ] JSON валиден

---

## Примеры заполненных ejercicios

### Пример 1: Предлоги (3 варианта)

```json
{
  "id": "ejercicio_1",
  "title": "Preposiciones: con, en, entre",
  "hint": "con / en / entre",
  "rule": {
    "title": "Предлоги CON, EN, ENTRE",
    "explanation": "Эти три предлога часто путают, но у каждого своя чёткая функция...",
    "sections": [
      {
        "subtitle": "CON — сопровождение, инструмент",
        "points": [
          "С кем делаешь действие: Vivo <b>con</b> mi familia — Живу с семьёй",
          "Чем/каким инструментом: Escribo <b>con</b> bolígrafo — Пишу ручкой"
        ]
      },
      {
        "subtitle": "EN — место, время",
        "points": [
          "Где (место): Estudio <b>en</b> la universidad — Учусь в университете",
          "Когда (время): <b>En</b> verano viajo mucho — Летом много путешествую"
        ]
      },
      {
        "subtitle": "ENTRE — между",
        "points": [
          "Между объектами: <b>Entre</b> la mesa y la silla — Между столом и стулом",
          "Между людьми: <b>Entre</b> nosotros no hay secretos — Между нами нет секретов"
        ]
      }
    ],
    "examples": [
      {"es": "Trabajo con mi hermano en una oficina.", "ru": "Я работаю с братом в офисе."},
      {"es": "La diferencia entre español y portugués no es grande.", "ru": "Разница между испанским и португальским небольшая."}
    ]
  },
  "questions": [
    {"sentence": "Estudio español ___ una academia de idiomas.", "answer": "en"},
    {"sentence": "Me gusta practicar ___ mis compañeros de clase.", "answer": "con"},
    {"sentence": "___ tú y yo no hay secretos.", "answer": "Entre"}
    // ... ещё 57 вопросов
  ],
  "microTests": [
    {
      "sentence": "Preparo la cena ___ mi madre.",
      "answer": "con",
      "hint": "С кем ты готовишь ужин?"
    },
    {
      "sentence": "Los documentos están ___ el cajón.",
      "answer": "en",
      "hint": "Где находятся документы?"
    },
    {
      "sentence": "Hay un jardín ___ las dos casas.",
      "answer": "entre",
      "hint": "Где расположен сад?"
    }
    // ... ещё 12 microTests
  ]
}
```

### Пример 2: Причина vs Цель (2 варианта)

```json
{
  "id": "ejercicio_2",
  "title": "porque vs para",
  "hint": "porque / para",
  "rule": {
    "title": "PORQUE vs PARA: причина и цель",
    "explanation": "PORQUE (потому что) объясняет причину — почему что-то произошло. PARA (для, чтобы) указывает на цель — для чего что-то делается.",
    "sections": [
      {
        "subtitle": "PORQUE — причина (¿Por qué? — Почему?)",
        "points": [
          "Объясняет причину действия или состояния",
          "Отвечает на вопрос «Почему?»",
          "После PORQUE идёт готовый факт"
        ]
      },
      {
        "subtitle": "PARA — цель (¿Para qué? — Зачем?)",
        "points": [
          "Указывает на цель действия",
          "Отвечает на вопрос «Для чего? Зачем?»",
          "После PARA часто идёт инфинитив"
        ]
      }
    ],
    "examples": [
      {"es": "Estudio español porque me gusta.", "ru": "Я учу испанский, потому что он мне нравится."},
      {"es": "Estudio español para trabajar en España.", "ru": "Я учу испанский, чтобы работать в Испании."}
    ]
  },
  "questions": [
    {"sentence": "Estudio español ___ me gusta la cultura.", "answer": "porque"},
    {"sentence": "Ahorro dinero ___ comprar un coche.", "answer": "para"}
    // ... ещё 58 вопросов (30 + 30)
  ],
  "microTests": [
    {
      "sentence": "Voy al gimnasio ___ estar en forma.",
      "answer": "para",
      "hint": "Какова цель? (для чего)"
    },
    {
      "sentence": "No salgo ___ estoy cansado.",
      "answer": "porque",
      "hint": "Какова причина? (почему)"
    }
    // ... ещё 8-18 microTests
  ]
}
```

---

## Типы грамматических упражнений

| Тип | Примеры hint | Количество questions |
|-----|-------------|---------------------|
| Предлоги | `con / en / entre` | 60 (по 20) |
| Союзы | `porque / para` | 60 (по 30) |
| Глаголы ser/estar | `soy / estoy` | 60 (по 30) |
| Спряжение | формы глагола | 60 (по формам) |
| Артикли | `el / la / los / las` | 60 (по 15) |

---

## Важные замечания

1. **Код универсален** — не нужно менять app.js, только заполнять JSON

2. **Прогресс автоматический** — система сама создаёт запись для нового ejercicio по его id

3. **Режимы:**
   - "Изучить правило" — показывает rule
   - "Проверь себя" — microTests с подсказками (3-4 слота)
   - "Пройти тест" — 15 случайных вопросов из questions (60)

4. **MAX_MICRO_TEST_SLOTS = 4** — максимум 4 слота microTests на экране

5. **Распределение вопросов:**
   - questions: равномерно по всем вариантам ответа
   - microTests: 3-5 на каждый вариант ответа

---

## Файлы

| Юнит | JSON файл | PDF источник |
|------|-----------|--------------|
| Unidad 1 | `data/Unidad1.json` | `SpanishExcercises/aula-internacional-plus-2-a2-*.pdf` |
| Unidad 2 | `data/Unidad2.json` | Соответствующий PDF |
| ... | ... | ... |
| Unidad 10 | `data/Unidad10.json` | Соответствующий PDF |
